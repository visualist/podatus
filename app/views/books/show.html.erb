<script>
  var book_id = <%= @id %>;
  var chapter_id = <%= @random_chapter_id %>;
  /* TODO: fix this suspect way to move data ruby->js */
  var chapters = <%= raw(@book.chapters.to_json) %>;
  var sentence_count = <%= @book.sentence_count %>,
      pixels_per_sentence = 3,
      graph_height = (pixels_per_sentence * sentence_count);

  $(document).ready(function() {
      var options = { book: book_id, chapter: 'all',
                          selector: "#vertical-graph-all",
                          width: 160, height: graph_height
                        };
      render_vstream_graph(options);

      $(document).on("mouseenter", ".line-hover", function(e) {
          var ypos = e.pageY - 60;
          var $this = $(this);
          var sent_number = $this.data("sn");
          var req_url = "/book/" + book_id + "/sentence/" + sent_number + ".json"
          $.get(req_url, function(d) {
              var content = sent_number + ". (" + d.slen + ") " + d.text;
              $("#hover-container").css("top", ypos)
                               .css("left", "320px")
                               .css("min-width", "240px")
                               .css("visibility", "visible")
                               .html(content);
          });

      }).on("mouseleave", ".line-hover", function() {
          var $this = $(this);
          $("#hover-container").css("visibility", "hidden").css("left", "-9000px");
      });

  });
</script>

<style>
  #hover-container {
    position: absolute;
    left: -9000px;
    visibility: hidden;
    border: 1px solid #b0b0b0;
    padding: 5px;
  }
  #vertical-graph-all {
    margin-left: 160px;
    margin-bottom: 40px;
  }
  line:hover {
    stroke: #b0b0b0;
    opacity: 1;
  }
</style>

<div id="book-detail-content">

  <div class="header">
    <h2><span class="title"><%= @book.title %></span>, by <span class="author"><%= @book.author %></span></h2>
    <span class="number-of-chapters"><%= @book.chapters.size %> chapters</span>
  </div>

  <div class="vertical-graph-container">
      <div class="vertical-graph" id="vertical-graph-all">
      </div>
      <div class="annotation">
      </div>
  </div>
  <div id="hover-container">
  </div>

</div>
